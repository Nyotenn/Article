# 目标检测

## 一、目标检测历史

![img](https://b2633864.smushcdn.com/2633864/wp-content/uploads/2022/04/history_of_od_generated.jpg?size=700x394&lossy=2&strip=1&webp=1)

### 1、Single-Stage Object Detectors And Two-Stage Object Detectors

> 单阶段检测器：Single-Stage Object Detectors are a class of object detection architectures that are one-stage. They treat object detection as a simple regression problem. For example, the input image fed to the network directly outputs the class probabilities and bounding box coordinates. 
>
> In single-stage, we apply the detection head directly on the feature map, while, in two-stage, we first apply a region-proposal network on the feature maps. Then, these regions are further passed to the second stage, making predictions for each region.

![img](..\assets\single_vs_two_stage-1024x746.png)

和多阶段检测器不同，单阶段检测器将目标检测视为一个简单的回归问题，直接输入图片信息，将边界信息和分类概率作为神经网络的输出。而对于多阶段检测器而言，在输入图片信息后，需要先经过 `region-proposal network`，输出检测框，再经过下一阶段（分类），输出分类概率。

尽管多阶段检测器在准确率上要高于单阶段检测器，但其在速度上有些欠缺。

### 2、Deformable Parts Models（DPM）

### 3、Histogram of Oriented Gradient（HOG）

HOG图像特征提取算法主要可以分为如下的几个步骤：

1. 图像预处理
2. 计算图像梯度
3. 计算梯度直方图
4. 图像HOG特征向量

#### 3.1、图像预处理

包括缩放、灰度化及Gamma矫正。

#### 3.2、计算图像梯度

直接使用一维的sober算子分别计算像素点的水平以及竖直方向的梯度：
$$
\begin{cases}
G_x(x,y)=H(x+1,y)-H(x-1,y) \\
G_y(x,y)=H(x,y+1)-H(x,y-1)
\end{cases}
$$
由水平、竖直梯度可求总梯度及其方向：
$$
G=\sqrt{G_x^2 + G_y^2}	\\
\theta=tan^{-1}(\frac{G_y}{G_x})
$$

#### 3.3、计算梯度直方图

假设64×64像素是检测的窗口的尺寸，分成 4×4=16 个细胞单元(cell)，如下图中黑色的小框(1-16),16×16 像素是每个细胞单元的大小，块（block）是由相邻的 2×2=4 个细胞单元组成的，如图紫色的小框，滑动窗口的大小为一个块的大小，依次将滑动窗口从左到右从上到下进行滑动来获得整个待测窗口的边缘信息，得到9个块，统计这9个块在9个不同方向上的梯度信息，在整个窗口中得到的梯度特征是9×9=81 维的向量。在实际情况中我们的检测窗口的大小为128×64像素，一个细胞单元的大小为8×8像素，由2×2个细胞单元组成大小为16×16像素的块，一个细胞单元的梯度直方图化成9个bins，块的移动步长是8个像素，则检测窗口在图像中移动的步长也为8个像素，这样检测窗口就有((128-16)/8+1)×((64-16)/8+1)= 105个块，一个块有4个细胞单元，每个细胞单元的HOG特征向量长度是9，则最终的HOG特征描述符大小就是105×4×9 = 3780维。




对于块的梯度直方图向量的归一化，ND大神等人使用了不同方法，并对结果进行了比较，假设V是未归一化的向量，是一个很小的必要的常数，下式是定义的范数的函数表达式：

L1范数：

![img](..\assets\20160812102530860.jpeg)

L2范数：

![img](..\assets\20160812102621464.jpeg)


归一化计算公式为：

L2常规：

![img](..\assets\20160812102714902.jpeg)

L1常规：

![img](..\assets\20160812102804216.jpeg)

L1平方根：

![img](..\assets\20160812102847592.jpeg)


ND大神等人指出，用L1常规方法进行向量归一化比用L2常规和L1平方根方法而得到的检测效果降低5%。

#### 3.4、图像HOG特征向量